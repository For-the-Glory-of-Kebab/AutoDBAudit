INFO:tests.atomic_e2e.core.test_harness:Setup test in: C:\Users\920\AppData\Local\Temp\atomic_e2e_2be_bz44
INFO:autodbaudit.infrastructure.sqlite.store:HistoryStore initialized: C:\Users\920\AppData\Local\Temp\atomic_e2e_2be_bz44\test_history.db
INFO:autodbaudit.infrastructure.sqlite.store:Database schema initialized (version 1)
INFO:autodbaudit.infrastructure.sqlite.store:Audit run started: id=1, org=Test Org
INFO:autodbaudit.infrastructure.excel.cover:Successfully added cover icon from F:\Raja-Initiative\assets\sql_audit_icon.png
INFO:autodbaudit.infrastructure.excel.writer:Report saved: C:\Users\920\AppData\Local\Temp\atomic_e2e_2be_bz44\test_report.xlsx (20 sheets, 0 issues, 0 passes, 0 warnings)
INFO:tests.atomic_e2e.core.test_harness:Created Excel with 1 findings
INFO:autodbaudit.application.annotation_sync:AnnotationSyncService initialized
INFO:autodbaudit.infrastructure.sqlite.store:Audit run started: id=2, org=Test Org (Sync)
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Instances ActionCol=None StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet SA Account ActionCol=0 StatusCol=3
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Server Logins ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Sensitive Roles ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Configuration ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Services ActionCol=0 StatusCol=5
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Databases ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Database Users ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Database Roles ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Permission Grants ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Orphaned Users ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Linked Servers ActionCol=1 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Triggers ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Client Protocols ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Backups ActionCol=0 StatusCol=9
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Audit Settings ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Encryption ActionCol=None StatusCol=8
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Actions ActionCol=None StatusCol=None
INFO:autodbaudit.application.annotation_sync:Read 1 annotations from 20 sheets
INFO:autodbaudit.application.annotation_sync:Loaded 0 annotation entries from database
INFO:autodbaudit.application.annotation_sync:Persisted 4 annotations to database
WARNING:autodbaudit.application.annotation_sync:DEBUG: _write_sheet_annotations for Linked Servers with 1 items
WARNING:autodbaudit.application.annotation_sync:DEBUG: Skipped Indicator Update for SRV|INST|LS1|local|remote (Just=, Exc=, Disc=False, Stat=None, Row=2)
INFO:autodbaudit.application.annotation_sync:Wrote 4 annotation cells to C:\Users\920\AppData\Local\Temp\atomic_e2e_2be_bz44\test_report.xlsx
INFO:tests.atomic_e2e.core.test_harness:Sync cycle 2: read=1, detected=0, written=4
INFO:autodbaudit.infrastructure.sqlite.store:Audit run started: id=3, org=Test Org (Sync)
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Instances ActionCol=None StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet SA Account ActionCol=0 StatusCol=3
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Server Logins ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Sensitive Roles ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Configuration ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Services ActionCol=0 StatusCol=5
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Databases ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Database Users ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Database Roles ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Permission Grants ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Orphaned Users ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Linked Servers ActionCol=1 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Triggers ActionCol=0 StatusCol=None
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Client Protocols ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Backups ActionCol=0 StatusCol=9
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Audit Settings ActionCol=0 StatusCol=6
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Encryption ActionCol=None StatusCol=8
WARNING:autodbaudit.application.annotation_sync:DEBUG: Sheet Actions ActionCol=None StatusCol=None
INFO:autodbaudit.application.annotation_sync:Read 1 annotations from 20 sheets
INFO:autodbaudit.application.annotation_sync:Loaded 1 annotation entries from database
INFO:autodbaudit.application.annotation_sync:Exception candidate: linked_server|srv|inst|ls1|local|remote -> finding_key=srv|inst|ls1|local|remote, status=FAIL
INFO:autodbaudit.application.annotation_sync:Exception added: linked_server - srv|inst|ls1|local|remote
INFO:autodbaudit.application.actions.action_recorder:Recorded action: Exception Documented - linked_server|srv|inst|ls1|local|remote
INFO:autodbaudit.application.annotation_sync:Persisted 4 annotations to database
WARNING:autodbaudit.application.annotation_sync:DEBUG: _write_sheet_annotations for Linked Servers with 1 items
INFO:autodbaudit.application.annotation_sync:Wrote 4 annotation cells to C:\Users\920\AppData\Local\Temp\atomic_e2e_2be_bz44\test_report.xlsx
INFO:tests.atomic_e2e.core.test_harness:Sync cycle 3: read=1, detected=1, written=4
WARNING:tests.atomic_e2e.core.test_harness:Failed to cleanup C:\Users\920\AppData\Local\Temp\atomic_e2e_2be_bz44: [WinError 32] The process cannot access the file because it is being used by another process: 'C:\\Users\\920\\AppData\\Local\\Temp\\atomic_e2e_2be_bz44\\test_history.db'

=== After first sync ===
Annotations read: 1
  linked_server|srv|inst|ls1|local|remote: {'review_status': '', 'purpose': '', 'justification': '', 'last_reviewed': ''}

=== Excel headers ===
  ['_UUID', '‚è≥', 'Server', 'Instance', 'Linked Server', 'Provider', 'Data Source', 'RPC Out', 'Local Login', 'Remote Login', 'Impersonate', 'Risk', 'Review Status', 'Purpose', 'Justification', 'Last Reviewed']

=== Excel row 2 ===
  ['6720611B', None, 'SRV', 'INST', 'LS1', 'SQLOLEDB', 'remote', '‚úì Yes', 'local', 'remote', '‚úó No', 'üü¢ Normal', None, None, 'Test justification', None]

=== After second sync (with justification) ===
Annotations read: 1
  linked_server|srv|inst|ls1|local|remote: {'review_status': '‚úì Exception', 'purpose': '', 'justification': 'Test justification', 'last_reviewed': ''}

Actions logged: 1
  {'id': 1, 'entity_key': 'linked_server|srv|inst|ls1|local|remote', 'finding_type': 'Linked Server', 'action_type': 'Exception Documented', 'status': 'exception', 'action_date': '2025-12-23T05:56:35.380072+00:00', 'description': 'Exception Documented: Test justification', 'notes': None, 'sync_run_id': 3, 'captured_at': '2025-12-23T05:56:35.380140+00:00'}
