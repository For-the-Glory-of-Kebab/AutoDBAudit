# Excel Report Layout

> **19 Sheets** generated by `python main.py --audit`

---

## Sheet Summary

| # | Sheet | Module | Purpose |
|---|-------|--------|---------|
| 1 | Cover | `cover.py` | Title page with summary stats |
| 2 | Instances | `instances.py` | SQL Server inventory |
| 3 | SA Account | `sa_account.py` | SA account security status |
| 4 | Server Logins | `logins.py` | Server login audit |
| 5 | Sensitive Roles | `roles.py` | sysadmin/securityadmin members |
| 6 | Configuration | `config.py` | sp_configure settings |
| 7 | Services | `services.py` | SQL Server services |
| 8 | Databases | `databases.py` | Database properties |
| 9 | Database Users | `db_users.py` | Per-database users |
| 10 | Database Roles | `db_roles.py` | Role memberships |
| 11 | Role Matrix | `role_matrix.py` | Visual grid of user roles |
| 12 | Permission Grants | `permissions.py` | Explicit GRANT/DENY audit |
| 13 | Orphaned Users | `orphaned_users.py` | Users without logins |
| 14 | Linked Servers | `linked_servers.py` | Linked server config |
| 15 | Triggers | `triggers.py` | Server/database triggers |
| 16 | Backups | `backups.py` | Backup status |
| 17 | Audit Settings | `audit_settings.py` | Audit configuration |
| 18 | Encryption | `encryption.py` | SMK/DMK/TDE status |
| 19 | Actions | `actions.py` | Remediation tracking |

---

## Sheet Details

### Cover
Summary dashboard with pass/fail/warn counts by category.

### Instances
| Column | Dropdown |
|--------|----------|
| Clustered | ✓ / ✗ |
| HADR | ✓ / ✗ |

### SA Account
| Column | Dropdown |
|--------|----------|
| Status | PASS / FAIL / WARN |
| Is Disabled | ✓ / ✗ |
| Is Renamed | ✓ / ✗ |

### Server Logins
| Column | Dropdown |
|--------|----------|
| Enabled | ✓ Yes / ✗ No |
| Password Policy | ✓ Yes / ✗ No / N/A |

### Sensitive Roles
Shows sysadmin, securityadmin, bulkadmin memberships with justification column.

### Configuration
| Column | Dropdown |
|--------|----------|
| Status | PASS / FAIL |
| Risk | High / Medium / Low |

Shows security-relevant sp_configure settings (xp_cmdshell, CLR, etc).

### Services
| Column | Dropdown |
|--------|----------|
| Status | Running / Stopped |
| Startup | Automatic / Manual / Disabled |
| Compliant | ✓ / ✗ |

### Databases
| Column | Dropdown |
|--------|----------|
| Recovery | Full / Simple / Bulk-Logged |
| State | Online / Offline / etc |
| Trustworthy | ✓ / ✗ |

### Database Users
Per-database user listing with orphan detection.

### Database Roles
Database role memberships (db_owner, db_datareader, etc).

### Role Matrix
Visual grid showing which users belong to which fixed database roles (`db_owner` etc).

### Permission Grants
Explicit `GRANT`, `DENY`, and `GRANT WITH GRANT OPTION` permissions at server and database scopes.

### Orphaned Users
Users without corresponding server logins.

### Linked Servers
| Column | Dropdown |
|--------|----------|
| RPC Out | ✓ / ✗ |
| Impersonate | ✓ / ✗ |
| Risk | High / Medium / Low |

### Triggers
Server and database-level triggers.

### Backups
| Column | Dropdown |
|--------|----------|
| Status | PASS / WARN / FAIL |

Shows last backup date and days since backup.

### Audit Settings
Login auditing and trace settings.

### Encryption
| Column | Dropdown |
|--------|----------|
| Key Type | SMK / DMK / TDE Certificate / DEK |
| Backup Status | ✓ Backed Up / ⚠️ Not Backed Up / N/A |
| Status | PASS / FAIL / WARN / N/A |

Covers:
- **SMK** (Service Master Key) - Instance level
- **DMK** (Database Master Key) - Per database
- **TDE** (Transparent Data Encryption) - Per database

### Actions
| Column | Dropdown |
|--------|----------|
| Category | SA Account / Configuration / Backup / Login / Permissions / Service / Database / Other |
| Risk Level | Critical / High / Medium / Low |
| Status | ⏳ Open / ✓ Closed / ⚠️ Exception |

Manual remediation tracking with assignee and due dates.

---

## Visual Features

- **Server/Instance Grouping**: Color rotation for visual distinction
- **Conditional Formatting**: Green=PASS, Red=FAIL, Yellow=WARN
- **Dropdowns**: All boolean/enum columns have validation
- **⏳ Action Column**: First column on most sheets shows a ⏳ indicator for rows needing attention:
  - **SA Account**: FAIL/WARN status rows
  - **Configuration**: FAIL status rows
  - **Server Logins**: Disabled logins or missing password policy
  - **Sensitive Roles**: Sysadmin members needing justification
  - **Linked Servers**: High-risk linked servers
  - **Backups**: FAIL/WARN backup status
  - **Orphaned Users**: All rows (all are warnings)
  - Filter on column A to quickly see all items needing attention

---

## Architecture

```
excel/
├── writer.py         # EnhancedReportWriter (combines mixins)
├── base.py           # BaseSheetMixin, helpers
├── server_group.py   # Color/merge mixin
├── cover.py          # Cover sheet
├── instances.py      # ... (one file per sheet)
├── encryption.py     # Encryption sheet (17)
└── actions.py        # Actions sheet (17)
```

---

*Last updated: 2025-12-08*
